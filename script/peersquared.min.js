var PR2=window.PR2||{};var $=PR2.utils;PR2.utils=function(){var e=function(e,t){for(var n in t){if(t[n]==""){continue}if(n=="html"){e.innerHTML=t[n]}else{e.setAttribute(n,t[n])}}};var t=function(e,t){for(var n in t){e.style[n]=t[n]}};return{get:document.getElementById.bind(document),create:function(n,o,a,r){var i=document.createElement(n);if(typeof o=="object"){o.appendChild(i)}else{document.getElementById(o).appendChild(i)}if(typeof a=="object"){e(i,a)}if(typeof r=="object"){t(i,r)}return i},css_value:function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},log:function(e,t){console.log(e+": "+t)},subscribe:function(e,t){for(event_type in t){e.addEventListener(event_type,t[event_type])}},inArray:function(e,t){return t.indexOf(e)==-1?false:true},css:t}}();PR2.camplayer=function(e){var t=PR2.utils,n=t.create("div",document.body,{id:"pr2_player_container"}),o=t.create("video",n,{id:"pr2_local_player","class":"pr2_player",height:200,width:300}),a=t.create("video",n,{id:"pr2_remote_player","class":"pr2_player",height:200,width:300}),r=t.create("span",n,{id:"pr2_cam_controls"},{display:"none"}),i=t.create("span",r,{id:"pr2_fullscreen_button"});cam_button=t.create("span",r,{id:"pr2_cam_button"});local_stream=null,local_player_start_handler=function(){},local_stream_stop_handler=function(){},remote_player_start_handler=function(){},remote_stream_stop_handler=function(){},fullscreen_button_click_handler=function(){};navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;var c=function(){navigator.getUserMedia({audio:true,video:true},function(e){cam_button.classList.add("pr2_active_cam_button");local_stream=e;cam_button.classList.add("pr2_active_cam_button");local_player_start_handler(local_stream);o.src=URL.createObjectURL(local_stream);o.play()},function(e){t.log("error",e)})};var l=function(e){cam_button.classList.remove("pr2_active_cam_button");local_stream.stop();local_stream=null;local_stream_stop_handler()};var s=function(e){a.src=URL.createObjectURL(e);a.play();remote_player_start_handler()};var d=function(){remote_stream.stop();remote_stream_stop_handler()};var u=function(e){if(e=="show"){r.style.display="block"}else if(e=="hide"){r.style.display="none"}};t.subscribe(cam_button,{click:function(){if(local_stream==null){c()}else{l()}}});t.subscribe(i,{click:function(){fullscreen_button_click_handler()}});e={addRemoteStream:function(e){s(e)},removeRemoteStream:function(){d()},startLocalStream:function(){c()},stopLocalStream:function(){l()},toggleControls:function(e){u(e)},onStartLocalStream:function(e){local_player_start_handler=e},onStopLocalStream:function(e){local_stream_stop_handler=e},onStartRemoteStream:function(e){remote_player_start_handler=e},onStopRemoteStream:function(e){remote_stream_stop_handler=e},onFullscreenButtonClick:function(e){fullscreen_button_click_handler=e}};return e}(PR2.camplayer);PR2.chatbox=function(e){var t=PR2.utils,n=true,o=function(){},a=function(){},r=function(){},i=t.create("div",document.body,{id:"pr2_chat_container"}),c=t.create("div",i,{id:"pr2_chat_conversation"}),l=t.create("textarea",i,{id:"pr2_chat_input"}),s=t.create("span",i),d=t.create("button",s,{id:"pr2_file_send_button"}),u=t.create("button",s,{id:"pr2_chat_send_button"},{opacity:"0.5"}),f=t.create("input",document.body,{type:"file",multiple:"true"},{display:"none"});var p=function(e,o,a){var r=t.create("div",c),i=t.create("div",c);if(!n){return}if(a=="local"){r.innerHTML='<span>you:</span><span id="file-'+e+'"><a data-action="revoke-offer" href="#">cancel</a> '+o+"</span>"}else if(a=="remote"){r.innerHTML='<span class="pr2_chat_other">other:</span><span id="file-'+e+'"><a data-action="decline-offer" href="#">decline</a> | <a data-action="accept-offer" href="#">accept</a> '+o+"</span>"}i.innerHTML='<span></span><span><progress value="0" max="100" id="progr-'+e+'"></progress></span>'};var h=function(e){if(e=="enable"){n=true;i.style.opacity="1";l.disabled=false;u.disabled=false;u.style.cursor="pointer"}else if(e=="disable"){n=false;i.style.opacity="0.4";l.disabled=true;u.disabled=true;u.style.cursor="default"}};var b=function(e){var t=[[":-?\\)","smile"],["8-\\|","nerd"],[";-?\\)","wink"],["\\*-?\\)","think"]],n=new RegExp("((https?://)[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])","gi");t.forEach(function(t){e=e.replace(new RegExp(t[0],"gi"),'<span class="pr2_emo pr2_emo_'+t[1]+'"></span>')});return e.replace(n,"<a href='$1' target='_blank'>$1</a>")};var _=function(){var e=l.value.trim();g("local",e);r(e);l.value=""};var g=function(e,t){var o,a;if(!n||t==""||t.length==0||typeof t!="string"){return}o=document.createElement("div");if(e=="remote"){o.classList.add("pr2_chat_other");a="Other"}else{a="You"}o.innerHTML="<span>"+a+":</span><span>"+b(t)+"</span>";c.appendChild(o);c.scrollTop=c.scrollHeight-parseInt(window.getComputedStyle(c).getPropertyValue("height").slice(0,-2),10)};var m=function(e,o,a,r){var i;if(!n){return}switch(a){case"downloading":i="downloading "+o+" <a href='#' action-data='cancel-download'>cancel</a>";break;case"uploading":i="uploading "+o+" <a href='#' action-data='cancel-upload'>cancel</a>";break;case"upload-waiting":i=o+" is waiting <a href='#' action-data='cancel-upload'>cancel</a>";break;case"download-waiting":i=o+" is waiting <a href='#' action-data='cancel-upload'>cancel</a>";break;case"upload-completed":i=o+" upload complete";break;case"download-completed":i="<a href='"+r+"' download='"+o+"'>"+o+"</a> is complete";break;case"download-canceled":i="Other canceled "+o;break;case"upload-canceled":i="You canceled "+o;break}t.get("file-"+e).innerHTML=i;c.scrollTop=c.scrollHeight-parseInt(window.getComputedStyle(c).getPropertyValue("height").slice(0,-2),10)};var y=function(e,n){t.get("progr-"+e).value=n};t.subscribe(d,{click:function(){f.click()}});t.subscribe(f,{change:function(e){o(e.target.files)}});t.subscribe(l,{keydown:function(e){if(n&&e.keyCode===13&&e.ctrlKey&&this.value.length>0){_()}},keyup:function(e){if(this.value.length>0){u.style.opacity=1}else{u.style.opacity=.5}},dragover:function(e){e.preventDefault()},drop:function(e){o(e.dataTransfer.files);e.preventDefault()}});t.subscribe(u,{click:function(){_()}});t.subscribe(c,{click:function(e){var t,n=e.target;if(n.tagName.toLowerCase()=="a"&&typeof n.dataset.action!="undefined"){e.preventDefault();a(n.dataset.action,n.parentElement.id.substring(5))}}});e={addMessage:function(e,t){g(e,t)},addFileOffer:function(e,t,n){p(e,t,n)},updateFileStatus:function(e,t,n,o){m(e,t,n,o)},updateFileProgress:function(e,t){y(e,t)},toggleStatus:function(e){h(e)},onMessageAdd:function(e){r=e},onFilesAdd:function(e){if(typeof e=="function"){o=e}},onLinkClicked:function(e){if(typeof e=="function"){a=e}}};return e}(PR2.chatbox);PR2.download=function(){var e=PR2.utils,t={},n=1e4,o=null,a=["exe","com","vb","vbs","vbe","cmd","bat","ws","wsf","scr","shs","pif","hta","jar","js","jse","lnk","dll"],r=function(){},i=function(){},c=function(){},l=function(){},s=function(){},d=function(){},u=function(){},f=function(){};var p=function(e,n){if(typeof t[e]=="undefined"){t[e]={};t[e].id=e;t[e].name=n;r(e,n)}else{throw new Error("duplicate file id")}};var h=function(e){if(t.hasOwnProperty(e)){offer_revoke_handler(e,t[e].name)}};var b=function(e){if(t.hasOwnProperty(e)&&t[e]!=o){l(e,t[e].name);delete t[e]}else{throw new Error("invalid file id")}};var _=function(e){if(t.hasOwnProperty(e)&&t[e]!=o){c(e,t[e].name)}else{throw new Error("invalid file id")}};var g=function(e,n,a,r,i){if(t.hasOwnProperty(e)&&t[e]!=o){o=t[e];o.id=e;o.current_chunk=0;o.size=a;o.type=r;o.chunk_count=i;o.data=[];s(e,o.name,o.size,o.type,o.chunk_count)}else{throw new Error("invalid file id")}};var m=function(e){if(o==null){throw new Error("invalid file id")}o.data.push(e);o.current_chunk++;file_progress=Math.ceil(o.current_chunk/o.chunk_count*100);u(o.id,file_progress);if(o.current_chunk==o.chunk_count){w()}};var y=function(n){if(!e.inArray(n,["local","remote"])){throw new Error("this is not a valid source")}d(o.id,o.name,n);delete t[file_id];o=null};var w=function(){var e=new Blob(o.data,{type:o.type}),t=URL.createObjectURL(e);f(o.id,o.name,t);URL.revokeObjectURL(e);o=null};return{receiveOffer:function(e,t){p(e,t)},revokeOffer:function(e,t){h(e,t)},declineOffer:function(e){b(e)},acceptOffer:function(e){_(e)},receiveFileMetaData:function(e,t,n,o,a){g(e,t,n,o,a)},receiveFileChunk:function(e){m(e)},cancelFile:function(e){y(e)},onOfferReceive:function(e){r=e},onOfferRevoke:function(e){offer_revoke_handler=e},onOfferAccept:function(e){c=e},onOfferDecline:function(e){l=e},onFileStart:function(e){s=e},onFileCancel:function(e){d=e},onFileProgress:function(e){u=e},onFileComplete:function(e){f=e}}}();PR2=window.PR2||{};PR2.fullscreen=function(e){var t=PR2.utils,n=function(){},o,a,r;if(document.cancelFullscreen){window.addEventListener("fullscreenchange",function(){n(document.mozFullScreenElement)});o=function(){return document.fullscreenElement},a=function(e){e.requestFullscreen()},r=function(){document.cancelFullscreen()},_onFullscreenChange=function(e){n=e}}else if(document.mozCancelFullScreen){window.addEventListener("mozfullscreenchange",function(){n(document.mozFullScreenElement)});o=function(){return document.mozFullScreenElement},a=function(e){e.mozRequestFullScreen()},r=function(){document.mozCancelFullScreen()},_onFullscreenChange=function(e){n=e}}else if(document.webkitCancelFullScreen){window.addEventListener("webkitfullscreenchange",function(){n(document.mozFullScreenElement)});o=function(){return document.webkitFullScreenElement},a=function(e){e.webkitRequestFullscreen()},r=function(){document.webkitCancelFullScreen()},_onFullscreenChange=function(e){n=e}}return{current:o,request:function(e){if(typeof e=="string"){e=t.get(e)}else{e=document.body}a(e)},cancel:r,onFullscreenChange:_onFullscreenChange}}(PR2.fullscreen);PR2=window.PR2||{};PR2.modals=function(e){var t=PR2.utils;var n=t.create("div",document.body,{id:"pr2_modal_background"}),o=t.create("div",document.body,{id:"pr2_info_modal"}),a=t.create("div",o,{id:"pr2_info_message"}),r=t.create("div",document.body,{id:"pr2_help_modal"}),i=t.create("div",document.body,{id:"pr2_help_modal_close"});i.addEventListener("click",function(){e.help("hide")});var c=null;var l=t.create("div",document.body,{id:"pr2_confirm_modal"});var s=t.create("div",l,{id:"pr2_confirm_question"});var d=t.create("button",l,{id:"pr2_confirm_yes",html:"Yes"});d.addEventListener("click",function(e){c();c=null;n.style.display="none";l.style.display="none"});var u=t.create("button",l,{id:"pr2_confirm_cancel",html:"Cancel"});u.addEventListener("click",function(e){c=null;n.style.display="none";l.style.display="none"});e={confirm:function(e,t){n.style.display="block";l.style.display="block";s.textContent=e;c=t},info:function(e,t){if(e=="show"){n.style.display="block";a.textContent=t;o.style.display="block"}else if(e=="hide"){n.style.display="none";o.style.display="none"}},help:function(e,t){var o;if(e=="hide"){n.style.display="none";r.style.display="none";i.style.display="none";document.location.hash=""}else if(e=="show"){n.style.display="block";r.style.display="block";i.style.display="block";o=new XMLHttpRequest;o.open("GET",t);o.responseType="document";o.onload=function(e){if(this.responseXML.documentElement.tagName=="parsererror"){console.log("There was an error loading the content");r.innerHTML="There was an error loading the content";return}r.innerHTML=this.responseXML.documentElement.innerHTML;r.scrollTop=0};o.onerror=function(e){console.log(e.currentTarget.response)};o.send(null)}},alert:function(e){}};return e}(PR2.modals);PR2.peer=function(){var e=PR2.utils,t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=window.RTCIceCandidate||window.mozRTCIceCandidate||window.RTCIceCandidate,o=mozRTCSessionDescription;servers={},options={},starter=false,dataPC=null,myCamPC=null,otherCamPC=null,whiteboard_data_channel=null,peer_info_data_channel=null,file_data_channel=null,common_data_channel=null,connected=false,local_stream=null,remote_stream=null,connection_handler=function(){},peer_info_handler=function(){},whiteboard_data_handler=function(){},common_data_handler=function(){},file_data_handler=function(){},remote_stream_handler=function(){},close_handler=function(){};var a=function(){dataPC=mozRTCPeerConnection();dataPC.ondatachannel=s;myCamPC=mozRTCPeerConnection();otherCamPC=mozRTCPeerConnection();otherCamPC.onaddstream=P;e.log("info","Peer objects are initialized")};var r=function(){starter=true;peer_info_data_channel=dataPC.createDataChannel("peer_info_data_channel",{reliable:true});peer_info_data_channel.onopen=h;peer_info_data_channel.onmessage=d;dataPC.createOffer(i,b);e.log("info","Peer connection is created")};var i=function(t){dataPC.setLocalDescription(t);e.log("info","Offer is created and description set/sent");peer_info_handler("sdp",t)};var c=function(t){dataPC.setLocalDescription(t);e.log("info","Answer is created and description set/sent");peer_info_handler("sdp",t)};var l=function(e,t){if(e=="sdp"){dataPC.setRemoteDescription(o(t));if(t.type=="offer"){dataPC.createAnswer(c,b)}}else if(e=="ice"){}};var s=function(e){var t=e.channel;switch(t.label){case"peer_info_data_channel":peer_info_data_channel=e.channel;peer_info_data_channel.onopen=h;peer_info_data_channel.onmessage=d;break;case"common_data_channel":common_data_channel=e.channel;common_data_channel.onmessage=f;break;case"file_data_channel":file_data_channel=e.channel;file_data_channel.onmessage=u;break;case"whiteboard_data_channel":whiteboard_data_channel=e.channel;whiteboard_data_channel.onmessage=p;break}};var d=function(e){var t=JSON.parse(e.data);switch(t.type){case"cam-offer":otherCamPC.setRemoteDescription(new o(t.sdp));otherCamPC.createAnswer(v,b);break;case"cam-answer":myCamPC.setRemoteDescription(new o(t.sdp));break}};var u=function(e){file_data_handler(e.data)};var f=function(e){common_data_handler(JSON.parse(e.data))};var p=function(e){whiteboard_data_handler(JSON.parse(e.data))};var h=function(e){connected=true;connection_handler();if(starter){file_data_channel=dataPC.createDataChannel("file_data_channel",{reliable:true});file_data_channel.onmessage=u;whiteboard_data_channel=dataPC.createDataChannel("whiteboard_data_channel",{reliable:true});whiteboard_data_channel.onmessage=p;common_data_channel=dataPC.createDataChannel("common_data_channel",{reliable:true});common_data_channel.onmessage=f}};var b=function(t){e.log("error",t.message)};var _=function(e){file_data_channel.send(e)};var g=function(e){common_data_channel.send(JSON.stringify(e))};var m=function(e){whiteboard_data_channel.send(JSON.stringify(e))};var y=function(e){if(!connected){throw new Error("There is no Peer Connection")}myCamPC.addStream(e);local_stream=e;myCamPC.createOffer(w,b)};var w=function(e){myCamPC.setLocalDescription(e);peer_info_data_channel.send(JSON.stringify({type:"cam-offer",sdp:e}))};var v=function(e){otherCamPC.setLocalDescription(e);peer_info_data_channel.send(JSON.stringify({type:"cam-answer",sdp:e}))};var P=function(e){remote_stream_handler(e.stream)};return{init:function(e,t){a()},connect:function(){r()},addStream:function(e){y(e)},addPeerInfo:function(e,t){l(e,t)},isConnected:function(){return connected},sendData:function(e){g(e)},sendFileData:function(e){_(e)},sendWhiteboardData:function(e){m(e)},onConnection:function(e){connection_handler=e},onPeerInfo:function(e){peer_info_handler=e},onClose:function(e){close_handler=e},onData:function(e){common_data_handler=e},onFileData:function(e){file_data_handler=e},onWhiteboardData:function(e){whiteboard_data_handler=e},onRemoteStream:function(e){remote_stream_handler=e}}}();PR2.shapes=function(e){var t={},n=function(){},o=function(){};var a=function(e){var o=Object.keys(e)[0];t[o]=e[o];n([o])};var r=function(e){var o=[];for(shape_object in e){if(e.hasOwnProperty(shape_object)){t[shape_object]=e[shape_object];o.push(shape_object)}}n(o)};_get=function(e){if(typeof t[e]=="undefined"){throw new Error("This shape does not exist")}return t[e]};_getAll=function(){return Object.create(t)};_remove=function(e){if(typeof t[e]=="undefined"){throw new Error("This shape does not exist")}delete t[e];o([e])};e={add:function(e){a(e)},addMultiple:function(e){r(e)},get:function(e){return _get(e)},getAll:function(){return _getAll()},remove:function(e){_remove(e)},onAdd:function(e){if(typeof e!="function"){throw new Error("This is not a function")}n=e},onRemove:function(e){if(typeof e!="function"){throw new Error("This is not a function")}remove_shape_handler=e}};return e}(PR2.shapes);PR2=window.PR2||{};PR2.shortcuts=function(e){var t=PR2.utils,n=[],o=[86];t.subscribe(window,{keydown:function(e){if(e.ctrlKey&&o.indexOf(e.keyCode)==-1){for(var t=0,a=n.length;t<a;t++){if(e.keyCode==n[t].key){e.preventDefault();n[t].action()}}}}});e={add:function(e){if(typeof e=="object"){n.push(e)}}};return e}(PR2.shortcuts);PR2=window.PR2||{};PR2.toolbar=function(e){var t=PR2.utils,n=null,o=t.create("span",document.body,{id:"pr2_toolbar"}),a=t.create("span",o,{id:"pr2_start_button","data-type":"open_button",title:"Start"}),r=t.create("ul",o,{id:"pr2_start_menu"},{display:"none",top:o.offsetHeight+4+"px"}),i=t.create("span",o,{id:"pr2_whiteboard_tools"}),c=t.create("span",i,{"class":"pr2_spacer"}),l=t.create("span",i,{id:"pr2_history_group"}),c=t.create("span",i,{"class":"pr2_spacer"}),s=t.create("span",i,{id:"pr2_action_group"}),c=t.create("span",i,{"class":"pr2_spacer"}),d=t.create("span",i,{id:"pr2_property_group"}),c=t.create("span",i,{"class":"pr2_spacer"});var u={button:function(e,n){var o=t.create("span",e,{id:n.id||"","data-type":"button","data-value":n.value,"class":"pr2_tool_button",title:n.title||""});if(n.enabled==false){o.classList.add("pr2_tool_button_disabled")}if(typeof n.group!="undefined"){o.dataset.group=n.group}o.action=n.action||function(){}},pulldown:function(e,n){var o=t.create("div",e,{"class":"pr2_select_wrapper"}),a=t.create("select",o,{id:n.id,"data-type":"pulldown"});a.action=n.action||function(){};n.items.forEach(function(e,n){t.create("option",a,{value:e,html:e})});t.subscribe(a,{change:function(e){a.action("change",this.value)}})},sub_menu:function(e,n){var o;var a=t.create("li",r,{id:n.id,"class":"pr2_startmenu_menu",html:n.label||"","data-access":n.access||"always"});var i=t.create("ul",a);n.items.forEach(function(e){o=t.create("li",i,{id:e.id,"data-type":"startmenu_button",html:e.label,"data-access":e.access||"always"});o.action=e.action})},menu_item:function(e,n){li=t.create("li",r,{id:n.id,"data-type":"startmenu_button",html:n.label,"data-access":n.access||"always"});li.action=n.action||function(){}},picker:function(e,n){var a=t.create("span",e,{id:n.id||"","data-type":"open_button","class":"pr2_toolbar_picker_button",title:n.title||"",data:n.data||""});var r=t.create("span",e,{"class":"pr2_toolbar_picker",title:n.title||""},{display:"none",left:a.offsetLeft+"px",top:o.offsetHeight+6+"px"});r.action=n.action||function(){};n.items.forEach(function(e,n){t.create("span",r,{id:e.id||"","data-type":"picker_button","class":"pr2_picker_button","data-value":e.value,title:e.title,style:e.style||""})})}};var f=function(e,n){var o=t.get(e),a,r;switch(o.dataset.type){case"button":r=o.parentElement;if(typeof o.dataset.group=="undefined"){return}for(var i=0,c=r.children.length;i<c;i++){if(r.children[i].dataset.group==o.dataset.group){r.children[i].classList.remove("pr2_tool_button_selected")}}o.classList.add("pr2_tool_button_selected");break;case"pulldown":o.value=n;break;case"open_button":a=o.nextElementSibling;for(var i=0,c=a.children.length;i<c;i++){if(a.children[i].dataset.value==n){o.setAttribute("style",a.children[i].getAttribute("style"))}}}};var p=function(e,n){var o=t.get(e);if(n=="enable"){o.classList.remove("pr2_tool_button_disabled")}else if(n=="disable"){o.classList.add("pr2_tool_button_disabled")}};var h=function(e){if(e=="show"){i.style.display="inline-block"}else if(e=="hide"){i.style.display="none"}};var b=function(e){var t=r.getElementsByTagName("li"),n,o,a;for(n=0,o=t.length;n<o;n++){a=t[n].dataset.access;switch(a){case"always":t[n].style.display="block";break;case"never":t[n].style.display="none";break;case"creator":t[n].style.display=e=="creator"?"block":"none";break;case"observer":t[n].style.display=e=="observer"?"block":"none";break}}};t.subscribe(o,{mousedown:function(e){var t,o=e.target,a=o.dataset.type;var r=function(){n.style.display="none";n=null};var i=function(){n=t;n.style.display="block"};switch(a){case"open_button":t=o.nextElementSibling;if(n==null){i()}else if(n==t){r()}else{r();i()}break;case"startmenu_button":o.action(o);if(n!=null){r()}break;case"picker_button":o.parentElement.action(o.dataset.value,o);if(n!=null){r()}break;case"button":o.action(o.dataset.value,o);if(n!=null){r()}break}}});t.subscribe(window,{mousedown:function(e){var t=e.target.dataset.type;if(n==null||typeof t!="undefined"){return}else{n.style.display="none";n=null}}});e={add:function(e,n,o){if(u.hasOwnProperty(n)&&t.inArray(e,["history","properties","actions"])){switch(e){case"properties":e=d;break;case"history":e=l;break;case"actions":e=s;break}u[n](e,o)}},addToMenu:function(e,n){if(u.hasOwnProperty(e)&&t.inArray(e,["sub_menu","menu_item"])){u[e]("menu",n)}},focus:function(e,t){f(e,t)},toggleButtonState:function(e,t){p(e,t)},toggleControls:function(e){h(e)},setMenuAccess:function(e){b(e)}};return e}(PR2.toolbar);PR2.upload=function(){var e=PR2.utils,t={},n=[],o=null,a=1e4,r=["exe","com","vb","vbs","vbe","cmd","bat","ws","wsf","scr","shs","pif","hta","jar","js","jse","lnk","dll"],i=function(){},c=function(){},l=function(){},s=function(){},d=function(){},u=function(){},f=function(){},p=function(){};var h=function(){if(o==null&&n.length>0){y(n.shift())}};var b=function(e){var n=Date.now().toString().slice(-12)+"-"+Math.random().toString().slice(-12);t[n]=e;i(n,e.name)};var _=function(e){if(t.hasOwnProperty(e)){s(e,t[e].name);delete t[e]}else{throw new Error("invalid file id")}};var g=function(e){if(t.hasOwnProperty(e)){n.push(e);h();c(e,t[e].name)}else{throw new Error("invalid file id")}};var m=function(e){if(t.hasOwnProperty(e)){l(e,t[e].name);delete t[e]}else{throw new Error("invalid file id")}};var y=function(e){var n=new FileReader;if(t.hasOwnProperty(e)){o=t[e];n.onload=function(t){o.buffer=t.target.result;o.id=e;o.chunk_count=Math.ceil(o.buffer.byteLength/a);o.current_chunk=0;d(e,o.name,o.size,o.type,o.chunk_count);n=null;v()};n.readAsArrayBuffer(o)}};var w=function(n){if(!e.inArray(n,["local","remote"])){throw new Error("this is not a valid source")}if(o!=null){u(o.id,o.name,n);delete t[o.id];o=null;h()}};var v=function(){var e,t,n;if(o==null){return}e=o.current_chunk*a;t=o.buffer.slice(e,e+a);n=Math.ceil(o.current_chunk/o.chunk_count*100);f(o.id,t,n);if(o.current_chunk==o.chunk_count){p(o.id,o.name);o=null}else{o.current_chunk++}};return{addFiles:function(t){for(var n=0;n<t.length;n++){if(r.indexOf(t[n].name.split(".").pop())>-1){e.log("warning",t[n].name+" has a potentially dangerous extension and was therefore blocked");return}b(t[n])}},acceptOffer:function(e){g(e)},declineOffer:function(e){_(e)},revokeOffer:function(e){m(e)},cancelFile:function(e){w(file_id,e)},informChunkReceived:function(){if(o==null){throw new Error("no chunk to send")}v()},informFileComplete:function(){h()},onOfferCreate:function(e){i=e},onOfferRevoke:function(e){l=e},onOfferDecline:function(e){s=e},onOfferAccept:function(e){c=e},onFileProgress:function(e){f=e},onFileStart:function(e){d=e},onFileCancel:function(e){u=e},onFileComplete:function(e){p=e}}}();PR2=window.PR2||{};PR2.user=function(e){var t=PR2.utils,n={},o=function(){},a;var r=function(e){if(typeof e!="object"){throw new Error("No credentials were provided")}else if(!t.inArray(e.level,["teacher","student"])){throw new Error("Level must be teacher or student")}else if(typeof e.name!="string"){throw new Error("User name must be of type string")}else if(typeof e.channel!="string"){throw new Error("Channel name must be of type string")}else{n=e}};var i=function(e){if(!t.inArray(e,["creator","observer"])){throw new Error("This is not a valid role")}a=e;o(e)};e={getCredentials:function(){return Object.create(n)},getRole:function(){return a},setCredentials:function(t){r(t);return e},setRole:function(t){i(t);return e},onRoleChange:function(e){if(typeof e!="function"){throw new Error("This is not a function")}o=e}};return e}(PR2.user);PR2=window.PR2||{};PR2.whiteboard=function(e){var t=PR2.utils,n=function(){},o=function(){},a=function(){},r={lineWidth:1,strokeStyle:"black",lineCap:"round",lineJoin:"round",background:""},i=false,c="",l=false,s,d,u=null,f=null,p=false;var h=t.create("div",document.body,{id:"pr2_canvas_container"});var b=t.create("canvas",h,{id:"pr2_canvas","class":"pr2_canvas"});var _=b.getContext("2d");var g=t.create("canvas",h,{id:"pr2_temp_canvas","class":"pr2_canvas"});var m=g.getContext("2d");var y=t.create("a",document.body,{id:"pr2_download_link",download:"canvas.png",target:"_blank"},{display:"none"});var w=t.create("input",document.body,{id:"pr2_file_picker",type:"file",accept:"image/*"},{display:"none"});var v=t.create("div",document.body,{contenteditable:"true"},{overflow:"hidden","max-height":0,"max-width":0,opacity:"hidden"});var P=t.create("div",document.body,{id:"pr2_remote_pointer"},{backgroundImage:"url(icons/pointer.png)"});var R=function(e,n){r.height=b.height=g.height=e;r.width=b.width=g.width=n;t.css(t.get("pr2_right_layer"),{left:b.offsetLeft+b.offsetWidth+"px"});t.css(t.get("pr2_bottom_layer"),{top:b.offsetTop+b.offsetHeight+"px"});S("lineWidth",r.lineWidth);S("strokeStyle",r.strokeStyle);S("lineCap",r.lineCap);S("lineJoin",r.lineJoin);J();M()};var k=function(e){N.replace(e);M()};var C=function(e){if(!t.inArray(e,["action","shape","strokeStyle","lineWidth","fontFamily","fontSize","lineJoin","lineCap","background"])){throw new Error("Invalid property: "+e)}if(e!="background"){return r[e]}else{return b.style.backgroundImage}};var S=function(e,n){if(!t.inArray(e,["action","shape","strokeStyle","lineWidth","fontFamily","fontSize","lineJoin","lineCap","background"])){throw new Error("Invalid property: "+e)}if(e!="background"){r[e]=n}if(e=="shape"){d=PR2.shapes.get(n).shapeFunction;o("shape",n)}else if(e=="action"){if(!t.inArray(n,["paint","point","shape","write","none"])){throw new Error(e+" is not a valid action")}if(!l){g.style.cursor="default"}else if(n=="point"){g.style.cursor="url(icons/pointer.png), move"}else if(n=="write"){g.style.cursor="text"}else if(n=="none"){g.style.cursor="default"}else{g.style.cursor="crosshair"}s=z[n];A.style.display="none";Y.style.display="none";o("action",n)}else if(t.inArray(e,["lineWidth","strokeStyle","lineCap","lineJoin"])){_[e]=n;m[e]=n;A.style.color=n;o(e,n)}else if(e=="fontFamily"||e=="fontSize"){A.style[e]=n;E.style[e]=n;A.style.height=E.scrollHeight+"px";o(e,n)}else if(e=="background"){b.style.backgroundImage=n;r[e]=n;o("background",n)}};var x=function(){var e=new Image,n,o=t.get("pr2_download_link");var a=document.createElement("canvas");var i=a.getContext("2d");a.height=r.height;a.width=r.width;if(b.style.backgroundImage==""){i.fillStyle="white";i.rect(0,0,b.width,b.height);i.fill();c()}else{n=b.style.backgroundImage.slice(5,-2);e.onload=function(){var t=_.createPattern(e,"repeat");i.rect(0,0,b.width,b.height);i.fillStyle=t;i.fill();c()};e.src=n}function c(){b.toBlob(function(e){var t=URL.createObjectURL(e),n=new Image;n.onload=function(){i.drawImage(n,0,0);l()};n.src=t},"image/png")}function l(){a.toBlob(function(e){var n=t.get("pr2_download_link");n.href=URL.createObjectURL(e);n.target="_blank";n.click()},"image/png")}};var F=function(e){switch(e.type){case"paint":L(e.config,e.data);break;case"image":T(e.data);break;case"write":O(e.config,e.data);break;case"shape":D(e.config,e.data);break}N.add(e.type,e.config,e.data)};var L=function(e,t){_.strokeStyle=e.color;_.lineWidth=e.width;z.paint("start",t[0][0],t[0][1]);for(var n=0,o=t.length;n<o;n++){z.paint("continue",t[n][0],t[n][1])}};var T=function(e){img=new Image;img.onload=function(){_.drawImage(img,e[0],e[1],e[2],e[3])};img.src=e[4]};var O=function(e,t){z.writeComplete(t[0],t[1],t[2],t[3],"normal "+e.size+" "+e.font,e.color,t[4])};var D=function(e,t){_.strokeStyle=e.color;_.lineWidth=e.width;d=PR2.shapes.get([e.shape]).shapeFunction;z.shape("start",t[0][0],t[0][1]);z.shape("end",t[1][0],t[1][1])};var M=function(){var e=N.get(),t=e.length,n={color:_.strokeStyle,width:_.lineWidth,func:d};var o=function(n){var a,r;if(n==t){return}r=e[n].config;a=e[n].data;switch(e[n].type){case"paint":_.strokeStyle=r.color;_.lineWidth=r.width;z.paint("start",a[0][0],a[0][1]);for(var i=0,c=a.length;i<c;i++){z.paint("continue",a[i][0],a[i][1])}o(n+1);break;case"image":img=new Image;img.onload=function(){_.drawImage(img,a[0],a[1],a[2],a[3]);o(n+1)};img.src=a[4];break;case"write":z.writeComplete(a[0],a[1],a[2],a[3],"normal "+r.size+" "+r.font,r.color,a[4]);o(n+1);break;case"shape":_.strokeStyle=r.color;_.lineWidth=r.width;d=PR2.shapes.get([r.shape]).shapeFunction;z.shape("start",a[0][0],a[0][1]);z.shape("end",a[1][0],a[1][1]);o(n+1);break}};_.clearRect(0,0,r.width,r.height);o(0);_.strokeStyle=n.color;_.lineWidth=n.width;d=n.func};var E=t.create("textarea",document.body,{id:"pr2_textheight_calculator"},{width:"200px",disabled:true});var A=t.create("textarea",document.body,{id:"pr2_text_editor","class":"pr2_editor pr2_handle"},{width:"200px"});var z={};z.none=function(){return};z.point=function(e,t,n){t=t+B.left;n=n+B.top;if(e=="start"){g.style.cursor="url(icons/pointer-click.png), move";a(t,n,"down")}else if(e=="continue"){a(t,n,"down_move")}else if(e=="end"){g.style.cursor="url(icons/pointer.png), move";a(t,n,"up")}else if(e=="up_move"){a(t,n,"up_move")}};z.write=function(e,t,n){if(p){return}if(e=="end"){if(A.style.display!="none"&&A.value!=""){var o=A.value.replace(/&/g,"&amp;");z.writeComplete(A.offsetLeft-b.offsetLeft,A.offsetTop-b.offsetTop,A.offsetWidth,A.offsetHeight,"normal "+r.fontSize+" "+r.fontFamily,r.strokeStyle,o,true)}else{I(t,n)}}};z.writeComplete=function(e,t,n,o,a,i,c,l){var s=new Image;var d="<svg xmlns='http://www.w3.org/2000/svg' width='"+n+"' height='"+o+"'>"+"<foreignObject width='100%' height='100%'>"+"<div xmlns='http://www.w3.org/1999/xhtml'>"+"<textarea style='border: 0; margin:0; outline:0; padding:0; background-color: transparent; font:"+a+"; color: "+i+"; height : "+o+"px; width: "+n+"px'>"+c+"</textarea>"+"</div>"+"</foreignObject>"+"</svg>";var u=new Blob([d],{type:"image/svg+xml;charset=utf-8"});var f=URL.createObjectURL(u);s.onload=function(){_.drawImage(s,e,t,n,o);URL.revokeObjectURL(f);if(l){N.add("write",{color:r.strokeStyle,font:r.fontFamily,size:r.fontSize,width:_.lineWidth},[A.offsetLeft-b.offsetLeft,A.offsetTop-b.offsetTop,A.offsetWidth,A.offsetHeight,A.value]);A.style.display="none"}};s.src=f};var I=function(e,n){var o,a;t.css(A,{display:"block",top:B.top+n+"px",left:B.left+e+"px",fontFamily:r.fontFamily,fontSize:r.fontSize,color:r.strokeStyle});A.value="";A.focus();a=A.offsetTop+A.offsetHeight-B.bottom;o=A.offsetLeft+A.offsetWidth-B.right;if(a>0){A.style.height=A.offsetHeight-a+"px"}if(o>0){A.style.width=A.offsetWidth-o+"px"}};var W=function(e,t,n){var o=e.offsetLeft+e.offsetWidth,a=o-10,r=e.offsetTop,i=r+10;return t>a&&n>r&&t<o&&n<i};var U=function(e,t,n){var o=e.offsetLeft+e.offsetWidth,a=o-10,r=e.offsetTop+e.offsetHeight,i=r-10;return t>a&&n>i&&t<o&&n<r};z.paint=function(){var e,t,n=[];return function(o,a,i,c){if(o=="start"){n=[];e=a-1,t=i-1;_.beginPath();_.moveTo(e,t);_.lineTo(a,i);_.closePath();_.stroke();if(c){n.push([a,i])}}else if(o=="continue"){_.beginPath();_.moveTo(e,t);_.lineTo(a,i);_.closePath();_.stroke();if(c){n.push([a,i])}}else if(o=="end"&&c){N.add("paint",{color:r.strokeStyle,width:r.lineWidth},n)}e=a,t=i}}();z.shape=function(){var e,t,n=[];return function(o,a,i,c){if(o=="start"){n=[];e=a,t=i;if(c){n.push([a,i])}}else if(o=="continue"){m.clearRect(0,0,r.width,r.height);
d(m,e,t,a,i)}else if(o=="end"){m.clearRect(0,0,r.width,r.height);d(_,e,t,a,i);if(c){n.push([a,i]);N.add("shape",{color:r.strokeStyle,width:r.lineWidth,shape:r.shape},n)}}}}();function j(e,n,o){var a=new Image;if(typeof e=="string"){r()}else{i()}function r(){a.onload=function(){t.css(Y,{display:"inline-block",top:o+"px",left:n+"px",backgroundImage:"url('icons/resize-handle.png'), url('"+e+"')",backgroundSize:"auto auto, 100% 100%"});p=true;dataURL=e;c()};a.src=e}function i(){var r;a.onload=function(){r=new FileReader;r.onload=function(e){dataURL=e.target.result;t.css(Y,{display:"inline-block",top:o+"px",left:n+"px",backgroundImage:"url('icons/resize-handle.png'), url('"+e.target.result+"')",backgroundSize:"auto auto, 100% 100%"});p=true;c()};r.readAsDataURL(e)};a.src=window.URL.createObjectURL(e)}function c(){var e=n+a.width-B.right,r=o+a.height-B.bottom,i=a.width/a.height;var c=B.right-n,l=B.bottom-o,s=c/l;if(e>0||r>0){if(s>i){t.css(Y,{height:l+"px",width:Math.round(l*i)+"px"})}else{t.css(Y,{width:c+"px",height:Math.round(l*s)+"px"})}}else{t.css(Y,{height:a.height+"px",width:a.width+"px"})}}}function H(e,t,n,o,a){var r=new Image;r.onload=function(){_.drawImage(r,t,n,o,a);N.add("image",null,[t,n,o,a,e]);Y.style.display="none";p=false};r.src=e}var N=function(){var e=[],t=[],o={clear:[],add:[],undo:[],redo:[]};var a=function(e,t){var n=o[e];for(var a=0,r=n.length;a<r;a++){n[a](e,t)}};return{add:function(o,a,r){var i={type:o,config:a,data:r};e.push(i);t=[];n("add",i)},redo:function(){var o=t.pop();e.push(o);n("redo",t.length==0?false:true)},undo:function(){var o=e.pop();t.push(o);n("undo",e.length==0?false:true)},get:function(){return e},count:function(){return e.length},backup_count:function(){return t.length},last:function(){return e[e.length-1]},clear:function(){e=[],t=[];n("clear",true)},concat:function(t){e.concat(t)},replace:function(n){e=n,t=[]}}}();store_=N;var B={};var J=function(){B={left:b.offsetLeft-window.scrollX,top:b.offsetTop-window.scrollY,right:b.offsetLeft+b.offsetWidth-window.scrollX,bottom:b.offsetTop+b.offsetHeight-window.scrollY}};J();s=z.none;d=function(){return};t.create("div",document.body,{id:"pr2_bottom_layer","class":"pr2_canvas_border_layers"},{top:b.offsetTop+b.offsetHeight+"px"});t.create("div",document.body,{id:"pr2_left_layer","class":"pr2_canvas_border_layers"});t.create("div",document.body,{id:"pr2_right_layer","class":"pr2_canvas_border_layers"},{left:b.offsetLeft+b.offsetWidth+"px"},{border:"solid red 1px"});t.subscribe(v,{DOMNodeInserted:function(e){var t=e.target;if(t.nodeType==1&&t.tagName.toLowerCase()=="img"){j(t.src,B.left+15,B.top+15);v.lastChild.remove()}}});t.subscribe(A,{keyup:function(){E.value=this.value;A.style.height=E.scrollHeight+"px"},mouseup:function(){E.style.width=A.offsetWidth-4+"px"},mousemove:function(e){if(W(this,e.clientX,e.clientY)){this.style.cursor="move"}else if(U(this,e.clientX,e.clientY)){this.style.cursor="se-resize"}else{this.style.cursor="auto"}},mousedown:function(e){if(W(this,e.clientX,e.clientY)){u=this}else if(U(this,e.clientX,e.clientY)){f=this}}});var Y=t.create("div",document.body,{"class":"pr2_editor",id:"pr2_image_editor"},{backgroundSize:"100% 100%"});t.subscribe(Y,{mousedown:function(e){if(U(this,e.clientX,e.clientY)){f=this;this.style.cursor="se-resize"}else{u=Y;Y.offsetX=e.clientX-Y.offsetLeft+"px";Y.offsetY=e.clientY-Y.offsetTop+"px"}},mousemove:function(e){if(U(this,e.clientX,e.clientY)){this.style.cursor="se-resize"}else{this.style.cursor="move"}}});t.subscribe(w,{change:function(t){var n=t.target.files[0];if(typeof n.type==undefined||!n.type.match(/image.*/))return;t.preventDefault();if(c=="whiteboard"){j(n,B.left+15,B.top+15)}else{var o=new FileReader;o.onload=function(t){e.setProperty("background","url("+t.target.result+")")};o.readAsDataURL(n)}}});t.subscribe(window,{mouseup:function(e){if(i){s("end",e.clientX-B.left,e.clientY-B.top,true)}f=null,u=null,i=false},mousemove:function(e){var n=e.target,o=e.clientX,a=e.clientY;e.preventDefault();if(i){s("continue",e.clientX-B.left,e.clientY-B.top,true)}else if(r.action=="point"){s("up_move",e.clientX-B.left,e.clientY-B.top)}else if(A==u){A.style.cursor="move";if(a<b.offsetTop){A.style.top=b.offsetTop+"px"}else if(a>=b.offsetTop+b.offsetHeight-A.offsetHeight+2){A.style.top=b.offsetTop+b.offsetHeight-A.offsetHeight+2+"px"}else{A.style.top=a+"px"}if(o-A.offsetWidth<b.offsetLeft){A.style.left=b.offsetLeft+"px"}else if(o>=b.offsetLeft+b.offsetWidth+2){A.style.left=b.offsetLeft+b.offsetWidth-A.offsetWidth+2+"px"}else{A.style.left=o-A.offsetWidth+"px"}}else if(Y==u){t.css(Y,{top:a-parseInt(Y.offsetY,10)+"px",left:o-parseInt(Y.offsetX,10)+"px"})}else if(A==f){t.css(A,{height:a-A.offsetTop+"px",width:o-A.offsetLeft+"px",cursor:"se-resize"})}else if(Y==f){t.css(Y,{height:a-Y.offsetTop+"px",width:o-Y.offsetLeft+"px",cursor:"se-resize"})}},keydown:function(e){if(e.target.tagName.toLowerCase()=="textarea"){return}if(e.keyCode==8&&p){e.preventDefault();Y.style.display="none";p=false}},paste:function(t){if(e.hasAccess()==false){t.preventDefault()}else if(t.target.tagName.toLowerCase()!="textarea"){v.focus()}}});t.subscribe(g,{dragover:function(e){e.preventDefault()},dragenter:function(e){e.preventDefault()},drop:function(t){var n=t.dataTransfer.files[0];if(!l){return}A.style.display="none";if(typeof n.type==undefined||!n.type.match(/image.*/))return;t.preventDefault();if(t.ctrlKey){var o=new FileReader;o.onload=function(t){e.setProperty("background","url("+t.target.result+")")};o.readAsDataURL(n)}else{j(n,t.clientX-B.left,t.clientY-B.top)}},mousedown:function(e){if(!l||p){return}e.preventDefault();i=true;s("start",e.clientX-B.left,e.clientY-B.top,true)},mousemove:function(e){if(!l||p){return}e.preventDefault();if(i){s("continue",e.clientX-B.left,e.clientY-B.top,true)}},mouseup:function(e){if(!l){return}else if(p){H(dataURL,Y.offsetLeft-B.left,Y.offsetTop-B.top,Y.offsetWidth-2,Y.offsetHeight-2);return}e.preventDefault();v.focus()}});e={addAction:function(e){F(e)},clear:function(){_.clearRect(0,0,r.width,r.height);N.clear()},getData:function(){return N.get()},getProperty:function(e){return C(e)},hasAccess:function(){return l},putImage:function(e){c=e;w.click()},redo:function(){if(N.backup_count()>0){N.redo();M()}},save:function(e){switch(e){case"local":x();break}},setAccess:function(e){if(e){l=true;if(typeof r.action!="undefined"){S("action",r.action)}}else{l=false;g.style.cursor="default"}},setDimensions:function(e,t){R(e,t)},setProperty:function(e,t){S(e,t)},setProperties:function(e){for(property in e){if(e.hasOwnProperty(property)){S(property,e[property])}}},loadActions:function(e){k(e)},undo:function(){if(N.count()>0){N.undo();M()}},onAction:function(e){n=e},onPropertyChange:function(e){o=e},onPointerAction:function(e){a=e}};return e}(PR2.whiteboard);(function(e){var t=PR2.utils;var n=["Arial","Avant Garde","Bookman","Calibri","Comic Sans MS","Courier","Georgia","Impact","Lucida Console","Tahoma","Times New Roman","Trebuchet MS","Verdana"],o=["8px","10px","12px","14px","16px","18px","24px","32px","40px","48px","72px"],a=[1,2,5,7,10,15,20],r=["Khaki","Yellow","Gold","Orange","Goldenrod","Lightgreen","Greenyellow","Lime","Green","Darkgreen","Orchid","Fuchsia","Hotpink","Blueviolet","Indigo","Salmon","Crimson","Firebrick","Red","Darkred","Cyan","Dodgerblue","Lightseagreen","Blue","Mediumblue","Tan","Peru","Chocolate","Saddlebrown","Brown","White","Lightgrey","Darkgray","Gray","Black"],i=[{title:"Simply white",url:"simply-white.png",type:"repeat"},{title:"Low contrast",url:"low-contrast.png",type:"repeat"},{title:"Medium blocked grid",url:"block-grid-medium.png",type:"repeat"},{title:"Small blocked grid",url:"block-grid-small.png",type:"repeat"},{title:"Large blocked grid",url:"block-grid-large.png",type:"repeat"},{title:"Writing paper",url:"writing-paper.png",type:"repeat"},{title:"Grid of dots",url:"dots.png",type:"repeat"},{title:"Medium inverted grid",url:"block-grid-medium-invert.png",type:"repeat"},{title:"School Board",url:"school-board.png",type:"repeat"},{title:"School Board grid",url:"school-board-grid.png",type:"repeat"}];PR2.shapes.addMultiple({line:{title:"Draw a line",style:"background-position: -84px 0",shapeFunction:function(e,t,n,o,a){e.beginPath();e.moveTo(t,n);e.lineTo(o,a);e.closePath();e.stroke()}},arrow:{title:"Draw an arrow",style:"background-position: -308px 0;",shapeFunction:function(e,t,n,o,a){var r=o-t,i=a-n,c=i/r,l=12,s=Math.PI*.12+Math.atan(c),d=Math.cos(s),u=Math.sin(s),f=Math.atan(c)-Math.PI*.12,p=Math.cos(f),h=Math.sin(f);if(o<t)l=-l;e.beginPath();e.moveTo(t,n);e.lineTo(o,a);e.lineTo(o-l*d,a-l*u);e.moveTo(o,a);e.lineTo(o-l*p,a-l*h);e.stroke()}},cosinus:{title:"Draw a cosinus",style:"background-position: 0 -28px;",shapeFunction:function(e,t,n,o,a){var r=o>t?o:t,i=o>t?t:o,c=(a-n)/2+n,l=c-n,s=r-i,d=0,u=Math.PI*2/s;e.beginPath();for(d=0;d<=s;d++){e.lineTo(d+i,-Math.cos(u*d)*l+c)}e.stroke()}},sinus:{title:"Draw a sinus",style:"background-position: -28px -28px",shapeFunction:function(e,t,n,o,a){var r=o>t?o:t,i=o>t?t:o,c=(a-n)/2+n,l=c-n,s=r-i,d=0,u=Math.PI*2/s;e.beginPath();for(d=0;d<=s;d++){e.lineTo(d+i,-Math.sin(u*d)*l+c)}e.stroke()}},axis:{title:"Draw an axis",style:"background-position: -364px 0;",shapeFunction:function(e,t,n,o,a){e.beginPath();e.moveTo(t+(o-t)/2,n);e.lineTo(t+(o-t)/2,a);e.moveTo(t,n+(a-n)/2);e.lineTo(o,n+(a-n)/2);e.closePath();e.stroke()}},triangle:{title:"Draw a triangle",style:"background-position: -56px 0;",shapeFunction:function(e,t,n,o,a){e.beginPath();e.moveTo(t,n);e.lineTo(t,a);e.lineTo(o,a);e.closePath();e.stroke()}},triangle2:{title:"Draw a triangle",style:"background-position: -336px 0;",shapeFunction:function(e,t,n,o,a){e.beginPath();e.moveTo(t+(o-t)/2,n);e.lineTo(o,a);e.lineTo(t,a);e.closePath();e.stroke()}},rectangle:{title:"Draw a rectangle",style:"background-position: 0 0;",shapeFunction:function(e,t,n,o,a){e.beginPath();e.rect(t,n,o-t,a-n);e.stroke()}},circle:{title:"Draw a circle",style:"background-position: -28px 0;",shapeFunction:function(e,t,n,o,a){var r=o-t,i=a-n,c=Math.max(Math.abs(r),Math.abs(i))/2,l=r>=0?t+c:t-c,s=i>=0?n+c:n-c;e.beginPath();e.arc(l,s,c,0,2*Math.PI);e.stroke()}},star:{title:"Draw a star",style:"background-position: -252px 0;",shapeFunction:function(e,t,n,o,a){var r=5,i=o-t,c=.3*i,l,s,d=2*Math.PI/r,u=Math.PI/2,f;e.moveTo(t,n);e.beginPath();for(f=0;f<=r;f++){l=(f+1)*d;s=l-d/2;e.lineTo(t+Math.round(Math.cos(s-u)*c),n+Math.round(Math.sin(s-u)*c));e.lineTo(t+Math.round(Math.cos(l-u)*i),n+Math.round(Math.sin(l-u)*i))}e.stroke()}}});var c=PR2.user.setCredentials(e).getCredentials().level;var l=t.get("pr2_remote_pointer");PR2.toolbar.addToMenu("sub_menu",{id:"pr2_whiteboard_functions",access:"always",label:"Whiteboard",items:[{id:"pr2_delegate_whiteboard",access:c=="teacher"?"always":"never",label:"Delegate control",action:function(){if(PR2.user.getRole()=="creator"){PR2.user.setRole("observer");PR2.peer.sendData(JSON.stringify({type:"change-role",role:"creator"}))}else{PR2.user.setRole("creator");PR2.peer.sendData(JSON.stringify({type:"change-role",role:"observer"}))}}},{id:"pr2_synhronize_whiteboard",access:c=="teacher"?"always":"never",label:"Synchronize",action:function(){PR2.modals.info("show","One moment... The whiteboards are synhronized now");PR2.peer.sendWhiteboardData(JSON.stringify({type:"synchronize",data:PR2.whiteboard.getData()}));PR2.peer.sendWhiteboardData(JSON.stringify({type:"receive-whiteboard-propertychange",property:"background",data:PR2.whiteboard.getProperty("background")}))}},{id:"pr2_clear_whiteboard",access:c=="teacher"?"always":"never",label:"Clear",action:function(){PR2.modals.confirm("Are you sure you want to clear the whiteboard?",PR2.whiteboard.clear)}},{id:"pr2_save_whiteboard_local",access:"always",label:"Save as image (local)",action:function(){PR2.whiteboard.save("local")}}]});PR2.toolbar.addToMenu("sub_menu",{id:"pr2_add_image_functions",access:"creator",label:"Images",items:[{id:"pr2_add_image",access:"creator",label:"Add to whiteboard",action:function(){PR2.whiteboard.putImage("whiteboard")}},{id:"pr2_add_image_background",access:"creator",label:"Add as background",action:function(){PR2.whiteboard.putImage("background")}}]});PR2.toolbar.addToMenu("menu_item",{id:"pr2_go_fullscreen",label:"Go fullscreen (Ctrl-F)",access:"always",action:function(){PR2.fullscreen.current()==null?PR2.fullscreen.request():PR2.fullscreen.cancel()}});PR2.toolbar.add("actions","button",{id:"pr2_point_button",group:"actions",value:"point",title:"Point with mouse (Ctrl-E)",action:function(e){PR2.whiteboard.setProperty("action",e)}});PR2.toolbar.add("actions","button",{id:"pr2_write_button",group:"actions",value:"write",title:"Write text (Ctrl-W)",action:function(e){PR2.whiteboard.setProperty("action",e)}});PR2.toolbar.add("actions","button",{id:"pr2_paint_button",group:"actions",value:"paint",title:"Draw with pencil (Ctrl-D)",action:function(e){PR2.whiteboard.setProperty("action",e)}});PR2.toolbar.add("actions","button",{id:"pr2_shape_button",group:"actions",value:"shape",title:"Draw a shape (Ctrl-S)",action:function(e){PR2.whiteboard.setProperty("action",e)}});PR2.toolbar.add("history","button",{id:"pr2_undo_button",value:"undo",title:"Undo last action (Ctrl-Z)",enabled:false,action:PR2.whiteboard.undo});PR2.toolbar.add("history","button",{id:"pr2_redo_button",value:"redo",title:"Redo last action",enabled:false,action:PR2.whiteboard.redo});PR2.toolbar.add("properties","picker",{id:"pr2_select_shape_button",title:"Select shape",items:function(){var e=PR2.shapes.getAll(),t=[];for(shapetype in e){t.push({value:shapetype,title:e[shapetype].title,style:e[shapetype].style})}return t}(),action:function(e,t){PR2.whiteboard.setProperty("shape",e)}});PR2.toolbar.add("properties","picker",{id:"pr2_select_linewidth_button",title:"Select width",items:function(){var e=[];a.forEach(function(t){e.push({value:t,title:"width: "+t+"px",style:"background-size : 20px "+t+"px !important"})});return e}(),action:function(e,t){PR2.whiteboard.setProperty("lineWidth",e)}});PR2.toolbar.add("properties","picker",{id:"pr2_select_color_button",title:"Select color",items:function(){var e=[];r.forEach(function(t){e.push({value:t.toLowerCase(),title:"color: "+t,style:"background-color : "+t})});return e}(),action:function(e,t){PR2.whiteboard.setProperty("strokeStyle",e)}});PR2.toolbar.add("properties","picker",{id:"pr2_select_bg_button",title:"Select background",items:function(){var e=[];i.forEach(function(t){e.push({value:"url(backgrounds/"+t.url+")",title:"background: "+t.title,style:"background-image : url(backgrounds/"+t.url+")"})});return e}(),action:function(e,t){PR2.whiteboard.setProperty("background",e)}});PR2.toolbar.add("properties","pulldown",{id:"pr2_select_font",items:n,action:function(e,t){PR2.whiteboard.setProperty("fontFamily",t)}});PR2.toolbar.add("properties","pulldown",{id:"pr2_select_fontsize",items:o,action:function(e,t){PR2.whiteboard.setProperty("fontSize",t)}});PR2.whiteboard.onPropertyChange(function(e,t){switch(e){case"fontSize":PR2.toolbar.focus("pr2_select_fontsize",t);break;case"fontFamily":PR2.toolbar.focus("pr2_select_font",t);break;case"lineWidth":PR2.toolbar.focus("pr2_select_linewidth_button",t);break;case"action":PR2.toolbar.focus("pr2_"+t+"_button");if(t=="point"&&PR2.user.getRole()=="observer"){l.style.display="block"}else{l.style.display="none"}break;case"shape":PR2.toolbar.focus("pr2_select_shape_button",t);break;case"strokeStyle":PR2.toolbar.focus("pr2_select_color_button",t);break;case"background":PR2.toolbar.focus("pr2_select_bg_button",t);break}if(PR2.user.getRole()=="creator"){PR2.peer.sendWhiteboardData(JSON.stringify({type:"receive-whiteboard-propertychange",property:e,data:t}))}});PR2.whiteboard.onAction(function(e,t){switch(e){case"clear":PR2.toolbar.toggleButtonState("pr2_redo_button","disable");PR2.toolbar.toggleButtonState("pr2_undo_button","disable");break;case"add":PR2.toolbar.toggleButtonState("pr2_undo_button","enable");PR2.toolbar.toggleButtonState("pr2_redo_button","disable");break;case"undo":PR2.toolbar.toggleButtonState("pr2_redo_button","enable");if(!t){PR2.toolbar.toggleButtonState("pr2_undo_button","disable")}break;case"redo":PR2.toolbar.toggleButtonState("pr2_undo_button","enable");if(!t){PR2.toolbar.toggleButtonState("pr2_redo_button","disable")}break}if(PR2.user.getRole()=="creator"){PR2.peer.sendWhiteboardData(JSON.stringify({type:"receive-whiteboard-action",action:e,data:t}))}});PR2.whiteboard.onPointerAction(function(e,t,n){PR2.peer.sendWhiteboardData(JSON.stringify({type:"point",x:e,y:t,state:n}))});PR2.whiteboard.setDimensions(600,900);PR2.whiteboard.setProperties({lineJoin:"round",lineCap:"round",strokeStyle:"black",lineWidth:1,background:"url(backgrounds/block-grid-medium.png)",shape:"line",action:"paint",fontFamily:"Verdana",fontSize:"14px"});var s=function(e,t){switch(e){case"undo":PR2.whiteboard.undo();break;case"redo":PR2.whiteboard.redo();break;case"add":PR2.whiteboard.addAction(t);break;case"clear":PR2.whiteboard.clear();break}};var d=function(e,t){PR2.whiteboard.setProperty(e,t)};var u=function(e){l.style.top=e.y+"px";l.style.left=e.x+"px";switch(e.state){case"up":l.style.backgroundImage="url(icons/pointer.png)";break;case"down":l.style.backgroundImage="url(icons/pointer-click.png)";break}};var f=function(e){PR2.whiteboard.clear();PR2.whiteboard.loadActions(e);PR2.modals.info("hide");PR2.peer.sendWhiteboardData(JSON.stringify({type:"synchronization-complete"}))};PR2.fullscreen.onFullscreenChange(function(e){if(e==null){t.get("pr2_go_fullscreen").textContent="Go fullscreen (Ctrl-F)";t.get("pr2_remote_player").classList.remove("pr2_remote_player_fullscreen")}else if(e==t.get("pr2_player_container")){t.get("pr2_remote_player").classList.add("pr2_remote_player_fullscreen")}else{t.get("pr2_go_fullscreen").textContent="Leave fullscreen (Ctrl-F)"}});PR2.shortcuts.add({key:87,action:function(){PR2.whiteboard.setProperty("action","write")}});PR2.shortcuts.add({key:68,action:function(){PR2.whiteboard.setProperty("action","paint")}});PR2.shortcuts.add({key:83,action:function(){PR2.whiteboard.setProperty("action","shape")}});PR2.shortcuts.add({key:69,action:function(){PR2.whiteboard.setProperty("action","point")}});PR2.shortcuts.add({key:79,action:function(){PR2.whiteboard.putImage("whiteboard")}});PR2.shortcuts.add({key:80,action:function(){PR2.whiteboard.putImage("background")}});PR2.shortcuts.add({key:70,action:function(){PR2.fullscreen.current()==null?PR2.fullscreen.request():PR2.fullscreen.cancel()}});PR2.shortcuts.add({key:90,action:PR2.whiteboard.undo});PR2.shortcuts.add({key:89,action:PR2.whiteboard.redo});(function(){var e=t.get("pr2_canvas"),n=t.get("pr2_chat_container"),o=t.get("pr2_player_container"),a=e.offsetLeft+e.offsetWidth,r=n.offsetTop+n.offsetHeight,i=1500;n.style.left=a+"px";o.style.left=a+"px";o.style.top=r+"px";if(window.screen.availWidth>i){n.style.right=o.style.right=window.screen.availWidth-i+"px"}})();PR2.modals.info("show","Waiting for "+(c=="teacher"?"student":"teacher")+" to join..");PR2.user.onRoleChange(function(e){PR2.whiteboard.setAccess(e=="creator"?true:false);PR2.toolbar.setMenuAccess(e);PR2.toolbar.toggleControls(e=="creator"?"show":"hide");t.get("pr2_delegate_whiteboard").textContent=e=="creator"?"Delegate control":"Take back control"});Socket.onUsersConnect(function(){PR2.peer.init();if(c=="teacher"){PR2.peer.connect()}});Socket.onMessage(function(e){PR2.peer.addPeerInfo(e.type,e.data)});var p=function(e){PR2.peer.sendData(JSON.stringify(e))};PR2.peer.onConnection(function(){PR2.modals.info("hide");setTimeout(function(){PR2.user.setRole(c=="teacher"?"creator":"observer");PR2.camplayer.toggleControls("show")},50)});PR2.peer.onPeerInfo(function(e,t){Socket.send({type:e,data:t})});PR2.peer.onData(function(e){e=JSON.parse(e);switch(e.type){case"close-connection":PR2.modals.info("show","Other has left");case"change-role":PR2.user.setRole(e.role);break;case"receive-chat-message":PR2.chatbox.addMessage("remote",e.message);break;case"receive-offer":PR2.download.receiveOffer(e.file_id,e.file_name);break;case"revoke-offer":PR2.download.revokeOffer(e.file_id);break;case"decline-offer":PR2.upload.declineOffer(e.file_id);break;case"accept-offer":PR2.upload.acceptOffer(e.file_id);break;case"start-file":PR2.download.receiveFileMetaData(e.file_id,e.file_name,e.file_size,e.file_type,e.chunk_count);break;case"receive-chunk":PR2.upload.informChunkReceived();break;case"inform-download-completed":PR2.upload.informFileComplete();break}});PR2.peer.onWhiteboardData(function(e){e=JSON.parse(e);switch(e.type){case"receive-whiteboard-propertychange":d(e.property,e.data);break;case"receive-whiteboard-action":s(e.action,e.data);break;case"synchronize":PR2.modals.info("show","One moment... The whiteboards are synhronized now");PR2.whiteboard.clear();f(e.data);break;case"synchronization-complete":PR2.modals.info("hide");break;case"point":u(e)}});PR2.peer.onRemoteStream(function(e){PR2.camplayer.addRemoteStream(e)});PR2.camplayer.onStartLocalStream(function(e){PR2.peer.addStream(e)});PR2.chatbox.onMessageAdd(function(e){PR2.peer.sendData(JSON.stringify({type:"receive-chat-message",message:e}))});PR2.camplayer.onFullscreenButtonClick(function(){if(PR2.fullscreen.current()==null){PR2.fullscreen.request("pr2_player_container")}else{PR2.fullscreen.cancel()}});PR2.chatbox.onLinkClicked(function(e,t){switch(e){case"revoke-offer":PR2.upload.revokeOffer(t);break;case"decline-offer":PR2.download.declineOffer(t);break;case"accept-offer":PR2.download.acceptOffer(t);break;case"cancel-upload":PR2.upload.cancelFile(t);break;case"cancel-download":PR2.download.cancelFile(t);break}});PR2.chatbox.onFilesAdd(function(e){PR2.upload.addFiles(e)});PR2.upload.onOfferCreate(function(e,t){PR2.chatbox.addFileOffer(e,t,"local");p({type:"receive-offer",file_id:e,file_name:t})});PR2.download.onOfferReceive(function(e,t){PR2.chatbox.addFileOffer(e,t,"remote")});PR2.upload.onOfferRevoke(function(e,t){PR2.chatbox.updateFileStatus(e,t,"upload-canceled");p({type:"revoke-offer",file_id:e,file_name:t})});PR2.download.onOfferRevoke(function(e,t){PR2.chatbox.updateFileStatus(e,t,"download-canceled")});PR2.upload.onOfferAccept(function(e,t){PR2.chatbox.updateFileStatus(e,t,"upload-waiting")});PR2.download.onOfferAccept(function(e,t){p({type:"accept-offer",file_id:e});PR2.chatbox.updateFileStatus(e,t,"download-waiting")});PR2.upload.onOfferDecline(function(e,t){PR2.chatbox.updateFileStatus(e,t,"download-canceled")});PR2.download.onOfferDecline(function(e,t){PR2.chatbox.updateFileStatus(e,t,"upload-canceled");p({type:"decline-offer",file_id:e})});PR2.upload.onFileCancel(function(e,t,n){if(n=="local"){PR2.chatbox.UpdateFileStatus(e,t,"upload-canceled");p({type:"cancel-upload",file_id:e,file_name:t})}else if(n=="remote"){PR2.chatbox.UpdateFileStatus(e,t,"download-canceled")}});PR2.download.onFileCancel(function(e,t,n){if(n=="local"){PR2.chatbox.updateFileStatus(e,t,"upload-canceled");p({type:"cancel-upload",file_id:e,file_name:t})}else if(n=="renote"){PR2.chatbox.UpdateFileStatus(e,t,"download-canceled")}});PR2.upload.onFileStart(function(e,t,n,o,a){PR2.chatbox.updateFileStatus(e,t,"uploading");p({type:"start-file",file_id:e,file_name:t,file_size:n,file_type:o,chunk_count:a})});PR2.download.onFileStart(function(e,t,n,o,a){PR2.chatbox.updateFileStatus(e,t,"downloading")});PR2.peer.onFileData(function(e){PR2.download.receiveFileChunk(e)});PR2.upload.onFileProgress(function(e,t,n){PR2.chatbox.updateFileProgress(e,n);PR2.peer.sendFileData(t)});PR2.download.onFileProgress(function(e,t){PR2.chatbox.updateFileProgress(e,t);p({type:"receive-chunk"})});PR2.upload.onFileComplete(function(e,t){PR2.chatbox.updateFileStatus(e,t,"upload-completed")});PR2.download.onFileComplete(function(e,t,n){PR2.chatbox.updateFileStatus(e,t,"download-completed",n);p({type:"inform-download-completed"})});Socket.open(user[1],user[0])})(credentials);